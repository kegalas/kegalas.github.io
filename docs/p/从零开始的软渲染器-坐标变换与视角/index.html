<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='我们的模型并不会停留在原地不动，比如当我们在游戏中前后左右移动时，其他物体相对于我们是在平移的。又比如在游戏中移动鼠标看向不同的地方，其他物'><title>从零开始的软渲染器 坐标变换与视角</title>

<link rel='canonical' href='https://kegalas.top/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='从零开始的软渲染器 坐标变换与视角'>
<meta property='og:description' content='我们的模型并不会停留在原地不动，比如当我们在游戏中前后左右移动时，其他物体相对于我们是在平移的。又比如在游戏中移动鼠标看向不同的地方，其他物'>
<meta property='og:url' content='https://kegalas.top/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/'>
<meta property='og:site_name' content='KegalaS的个人博客'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='图形学' /><meta property='article:tag' content='渲染' /><meta property='article:tag' content='干货' /><meta property='article:published_time' content='2024-09-22T22:53:54&#43;08:00'/><meta property='article:modified_time' content='2024-09-22T22:53:54&#43;08:00'/><meta property='og:image' content='https://kegalas.top/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/cover.jpg' />
<meta name="twitter:title" content="从零开始的软渲染器 坐标变换与视角">
<meta name="twitter:description" content="我们的模型并不会停留在原地不动，比如当我们在游戏中前后左右移动时，其他物体相对于我们是在平移的。又比如在游戏中移动鼠标看向不同的地方，其他物"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://kegalas.top/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/cover.jpg' />
    <link rel="shortcut icon" href="/images/favicon.ico" />

    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>返回</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/cover_hudaf40032a0fd8dda1c6536765f6be1f9_238362_800x0_resize_q75_box.jpg"
                        srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/cover_hudaf40032a0fd8dda1c6536765f6be1f9_238362_800x0_resize_q75_box.jpg 800w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/cover_hudaf40032a0fd8dda1c6536765f6be1f9_238362_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post 从零开始的软渲染器 坐标变换与视角" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" >
                图形学
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/">从零开始的软渲染器 坐标变换与视角</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 22, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 13 分钟
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p>我们的模型并不会停留在原地不动，比如当我们在游戏中前后左右移动时，其他物体相对于我们是在平移的。又比如在游戏中移动鼠标看向不同的地方，其他物体和我们距离保持不变，但方向却改编了。</p>
<p>为此，研究物体的坐标变换是十分有必要的。</p>
<p>我们之前都只是简单的把物体的<span class="math inline">\(z\)</span>轴坐标去掉，只用<span class="math inline">\(x,y\)</span>轴坐标来画图。这导致的问题是，我们无法实现近大远小的效果，美术上也把这个称为透视原理。为此，我们还必须研究一种方法，让渲染考虑<span class="math inline">\(z\)</span>轴坐标，实现对于透视的模拟。</p>
<h1 id="坐标变换">坐标变换</h1>
<p>一般来说，我们主要用到平移、旋转、缩放，其他的如切变、镜像等并不是很常用到，暂时不做介绍。另外，我们最开始打算的就是在三维空间中运行，所以就不介绍更简单的二维情况了</p>
<h2 id="缩放">缩放</h2>
<p>从最简单的缩放讲起，如果一个点是<span class="math inline">\((x,y,z)\)</span>，那么把他缩放<span class="math inline">\(k\)</span>倍，就是简单的<span class="math inline">\((kx,ky,kz)\)</span>。这实在是过于显然的结论。用矩阵实现的话，这个变换的矩阵是</p>
<p><span class="math display">\[\begin{bmatrix}
 k & 0 & 0\\
 0 & k & 0\\
 0 & 0 & k
\end{bmatrix}
\]</span></p>
<p>当然，如果你想让各个轴上缩放比例不一样，例如<span class="math inline">\(x\)</span>轴缩放<span class="math inline">\(k_x\)</span>倍，<span class="math inline">\(y\)</span>轴缩放<span class="math inline">\(k_y\)</span>倍，<span class="math inline">\(z\)</span>轴缩放<span class="math inline">\(k_z\)</span>倍，那么</p>
<p><span class="math display">\[\begin{bmatrix}
 k_x & 0 & 0\\
 0 & k_y & 0\\
 0 & 0 & k_z
\end{bmatrix}
\]</span></p>
<p>其作用在某一点<span class="math inline">\((x,y,z)^T\)</span>上，结果为</p>
<p><span class="math display">\[\begin{bmatrix}
 k_x & 0 & 0\\
 0 & k_y & 0\\
 0 & 0 & k_z
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z
\end{bmatrix}=
\begin{bmatrix}
 k_xx\\
 k_yy\\
 k_zz
\end{bmatrix}
\]</span></p>
<p>写成四维（后面介绍为什么）的形式就是</p>
<p><span class="math display">\[\begin{bmatrix}
 k_x & 0 & 0 & 0\\
 0 & k_y & 0 & 0\\
 0 & 0 & k_z & 0\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z\\
 1
\end{bmatrix}=
\begin{bmatrix}
 k_xx\\
 k_yy\\
 k_zz\\
 1
\end{bmatrix}
\]</span></p>
<h2 id="平移">平移</h2>
<p>事实上，三维矩阵是无法进行平移的，我们必须加入一维。</p>
<p>前面提到，我们在图形学中一般最多也就用到四维坐标，我把为什么用以及如何使用四维坐标放到本章附录里。我们先讨论如何平移。</p>
<p>具体而言，我们引入下面这个矩阵</p>
<p><span class="math display">\[\begin{bmatrix}
 1 & 0 & 0 & t_x\\
 0 & 1 & 0 & t_y\\
 0 & 0 & 1 & t_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\]</span></p>
<p>对于任意一点<span class="math inline">\((x,y,z,1)^T\)</span>应用这个变换，得到</p>
<p><span class="math display">\[\begin{bmatrix}
 1 & 0 & 0 & t_x\\
 0 & 1 & 0 & t_y\\
 0 & 0 & 1 & t_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z\\
 1
\end{bmatrix}=
\begin{bmatrix}
 x+t_x\\
 y+t_y\\
 z+t_z\\
 1
\end{bmatrix}
\]</span></p>
<p>我们很自然地发现，这就是真正的平移，每个坐标都位移了<span class="math inline">\(t\)</span>的距离。</p>
<h2 id="旋转">旋转</h2>
<p>旋转操作有很多办法，例如欧拉角，四元数等等。这次我们先讨论欧拉角，未来可能会添加上四位数（TODO）</p>
<p>在二维空间中，一个点绕原点逆时针旋转<span class="math inline">\(\phi\)</span>得到的新点为</p>
<p><span class="math display">\[\begin{bmatrix}
 \cos\phi & -\sin\phi\\
 \sin\phi & \cos\phi
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
\end{bmatrix}
\]</span></p>
<p>在三维空间中，这个旋转就相当于点绕<span class="math inline">\(z\)</span>轴旋转，容易推出绕三个轴的旋转矩阵。</p>
<p><span class="math display">\[rotate-z(\phi)=
\begin{bmatrix}
cos\phi  & -sin\phi & 0\\
sin\phi  & cos\phi & 0\\
0  & 0 & 1
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[rotate-x(\phi)=
\begin{bmatrix}
1  & 0 & 0\\
0  & cos\phi & -sin\phi\\
0  & sin\phi & cos\phi
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[rotate-y(\phi)=
\begin{bmatrix}
cos\phi  & 0 & sin\phi\\
0  & 1 & 0\\
-sin\phi  & 0 & cos\phi
\end{bmatrix}
\]</span></p>
<p>同样的，我们也可以很方便地将其扩展为4维矩阵。</p>
<h2 id="复合变换">复合变换</h2>
<p>我们有时会对一个点进行连续的变换，例如先把他缩放50%，再把它旋转某个角度，再把它平移。设缩放矩阵为<span class="math inline">\(M_1\)</span>，旋转矩阵为<span class="math inline">\(M_2\)</span>，平移矩阵为<span class="math inline">\(M_3\)</span>，我们的点初始为<span class="math inline">\(P^{(0)}\)</span></p>
<p>首先进行的是缩放，那么<span class="math inline">\(P^{(1)}=M_1P^{(0)}\)</span>，然后再进行旋转，那么<span class="math inline">\(P^{(2)}=M_2P^{(1)}\)</span>，然后再平移，那么<span class="math inline">\(P^{(3)}=M_3P^{(2)}\)</span>。代入展开得</p>
<p><span class="math display">\[P^{(3)} = M_3M_2M_1P^{(0)}
\]</span></p>
<p>这里我想指出非常明显的一点，就是变换的顺序不可以任意交换。例如，对<span class="math inline">\((1,0)\)</span>这个点，先逆时针旋转180度，再向右平移一个单位，得到<span class="math inline">\((0,0)\)</span>。而先平移再旋转就得到<span class="math inline">\((-2,0)\)</span>。</p>
<p>体现在矩阵上也是一样的，根据线性代数知识，我们知道，矩阵乘法有结合律，但是没有交换律。也就是例如，<span class="math inline">\(M_3M_2M_1P^{(0)}\)</span>和<span class="math inline">\(M_2M_3M_1P^{(0)}\)</span>，在绝大部分情况下都是不相等的。</p>
<p>我们计算确实是从左到右计算，但是我们观察这个式子，判断其是以什么顺序变换的，却是反过来从右到左看，先进行<span class="math inline">\(M_1\)</span>变换，再进行<span class="math inline">\(M_2\)</span>变换，最后再<span class="math inline">\(M_3\)</span>变换</p>
<h1 id="视角变换">视角变换</h1>
<p>我们为什么需要变换视角？我们需要先介绍一下空间坐标系统</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 203; 
			flex-basis: 487px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/1.png" data-size="800x394">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/1.png"
			width="800"
			height="394"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/1_hu7d6879e9124c76d2e5f3edcb61749bf4_41397_480x0_resize_box_3.png 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/1_hu7d6879e9124c76d2e5f3edcb61749bf4_41397_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="1.png">
	</a>
	
	<figcaption>1.png</figcaption>
	
</figure></p>
<p>看这个图，我们一般会用到<span class="math inline">\(5\)</span>个坐标系。</p>
<ol>
<li>局部空间。其指的是物体模型自己的坐标，也就是我们之前在OBJ文件里见到的那个坐标。它有自己的原点，每个不同的模型、或者相同模型的不同实例都可以有自己的原点，也就有了自己的坐标。其不需要加载到你的程序中，这个坐标就存在了。以真实世界作为类比的话，局部空间相当于你这个人的肚脐眼为原点的空间，只保存我这个人的信息。</li>
<li>世界空间。当你把模型加载到你的“游戏世界”，这个世界本身是有一个坐标的，以真实世界为类比，相当于宇宙的坐标系。你在这个宇宙有一个确切的坐标（如果原点确定）。这个空间存储了许多模型的信息。通过之前提到的平移、缩放、旋转矩阵，我们把物体放到世界各处。刚导入的时候，模型原点和世界原点是重叠的，所以我们只需要对局部空间的坐标应用上变换矩阵，就得到世界空间的坐标了。</li>
<li>观察空间。也可以叫他摄像机空间。比起局部空间，观察空间更像是把世界空间的原点和坐标轴进行位移、旋转后得到的空间，其包含了众多模型的信息。而原来世界的原点会被变换到相机的位置，坐标轴会根据相机的朝向而设定。</li>
<li>裁剪空间。你的摄像机并不能看到所有的东西，例如他有长宽高的限制，又例如你看不到背后的东西，再例如远处的东西太小了对你来说看不见。所以你的摄像机实际上能看到的东西只是整个观察空间中的一个很小的子集。通过投影矩阵（正交或透视投影，之后会介绍），你把能看到的东西映射到一个<span class="math inline">\([-1,1]^3\)</span>的正方形盒子里。看不到的东西则在这个盒子外，也就是被剪裁了。</li>
<li>屏幕空间。这里是离散的，并且是<span class="math inline">\(2\)</span>维的，你的屏幕（或者窗口）的分辨率是多少，屏幕空间大小就是多少。把剪裁空间里的东西真正放到屏幕上显示出来，就从剪裁空间转换到了屏幕空间。</li>
</ol>
<h2 id="模型变换">模型变换</h2>
<p>也就是图上的Model Matrix，其实就是之前将的缩放、平移、旋转矩阵，不需要再讲。这个矩阵记作<span class="math inline">\(M_m\)</span></p>
<h2 id="视口变换">视口变换</h2>
<p>我们先来讲最简单的视口变换，也就是图上的Viewport Transform，最后一步的矩阵。</p>
<p>为了统一与便利，我们在最后一步之前，所有可见物体的<span class="math inline">\(x,y\)</span>坐标都被限制在<span class="math inline">\([-1, 1]\)</span>这个连续范围内。但显然，我们的图片、显示屏等都是一个像素一个像素地去描述，其坐标是在<span class="math inline">\([0, witdh],[0,height]\)</span>这个离散区间内，所以我们就需要一个变换来进行转换。</p>
<p>非常容易想到，先将<span class="math inline">\([-1, 1]\)</span>平移变成<span class="math inline">\([0, 2]\)</span>，除以<span class="math inline">\(2\)</span>变成<span class="math inline">\([0,1]\)</span>，再乘以宽度或高度，就有<span class="math inline">\([0, width]\)</span>。写成矩阵形式如下</p>
<p><span class="math display">\[\begin{bmatrix}
 w & 0 & 0 & 0\\
 0 & h & 0 & 0\\
 0 & 0 & 1 & 0\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 1/2 & 0 & 0 & 0\\
 0 & 1/2 & 0 & 0\\
 0 & 0 & 1 & 0\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 1 & 0 & 0 & 1\\
 0 & 1 & 0 & 1\\
 0 & 0 & 1 & 0\\
 0 & 0 & 0 & 1
\end{bmatrix} = 
\begin{bmatrix}
 w/2 & 0 & 0 & w/2\\
 0 & h/2 & 0 & h/2\\
 0 & 0 & 1 & 0\\
 0 & 0 & 0 & 1
\end{bmatrix}
\]</span></p>
<p>其中<span class="math inline">\(w, h\)</span>为图片的宽和高。我们称最后这个矩阵<span class="math inline">\(M_{vp}\)</span></p>
<h2 id="相机变换">相机变换</h2>
<p>即图上的View Matrix变换。相机变换的目的是，将世界坐标的原点变换到相机这里，从而方便计算物体对于相机的远近关系、遮挡关系等等。</p>
<p>和OpenGL保持一致，我们使用右手系，并且摄像机看向的方向是<span class="math inline">\(-z\)</span>方向，摄像机的头顶是<span class="math inline">\(y\)</span>方向，右边是<span class="math inline">\(x\)</span>方向，如下图。</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 130; 
			flex-basis: 312px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/2.jpg" data-size="965x742">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/2.jpg"
			width="965"
			height="742"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/2_hu44b4b6efa158a8705db365669c8b5001_87361_480x0_resize_q75_box.jpg 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/2_hu44b4b6efa158a8705db365669c8b5001_87361_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			alt="2.jpg">
	</a>
	
	<figcaption>2.jpg</figcaption>
	
</figure></p>
<p>我们可以把相机变换分为两步来看，首先是将原点平移到相机位置，或者更准确的说，是将相机的位置放置在<span class="math inline">\([0,0,0]^T\)</span>，世界上的其他物体都平移相同的距离和方向。矩阵如下</p>
<p><span class="math display">\[\begin{bmatrix}
 1 & 0 & 0 & -c_x\\
 0 & 1 & 0 & -c_y\\
 0 & 0 & 1 & -c_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\]</span></p>
<p>其中<span class="math inline">\(\bm c\)</span>是相机的世界坐标。</p>
<p>第二步是将世界坐标方向旋转到和相机的坐标方向相同。其实就是线性代数里的坐标变换。</p>
<p>刚才我们也说过，我们的相机看向（gaze，<span class="math inline">\(g\)</span>）<span class="math inline">\(-z\)</span>轴，其头上（up，<span class="math inline">\(u\)</span>）的方向为<span class="math inline">\(y\)</span>轴，右边（right，<span class="math inline">\(r\)</span>）为<span class="math inline">\(x\)</span>轴。由线性代数知识，任意基向量矩阵<span class="math inline">\(\times\)</span>某点在该基下的坐标<span class="math inline">\(=\)</span>该点在自然基下的坐标。。那么，对于自然基的点<span class="math inline">\([1, 1, 1]\)</span>，其相机基向量矩阵和在相机坐标系下的坐标满足</p>
<p><span class="math display">\[\begin{bmatrix}
 r_x & u_x & -g_x \\
 r_y & u_y & -g_y \\
 r_z & u_z & -g_z 
\end{bmatrix}
\overrightarrow{x} = 
[1,1,1]^T
\]</span></p>
<p>一般情况下，我们的<span class="math inline">\(\bm r, \bm u, \bm g\)</span>都是单位向量。只要上式两边同乘基向量矩阵的逆矩阵，就可以计算出<span class="math inline">\(\bm x\)</span>了。而显然，这个矩阵是正交矩阵，只需要转置即可。</p>
<p>综上所述，世界坐标系上的任意一点在相机坐标系下的坐标为</p>
<p><span class="math display">\[\begin{bmatrix}
 r_x & r_y & r_z & 0\\
 u_x & u_y & u_z & 0\\
 -g_x & -g_y & -g_z & 0\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 1 & 0 & 0 & -c_x\\
 0 & 1 & 0 & -c_y\\
 0 & 0 & 1 & -c_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z\\
 1
\end{bmatrix}
\]</span></p>
<p>合并矩阵得</p>
<p><span class="math display">\[\begin{bmatrix}
 r_x & r_y & r_z & -c_x\\
 u_x & u_y & u_z & -c_y\\
 -g_x & -g_y & -g_z & -c_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z\\
 1
\end{bmatrix}
\]</span></p>
<p>左边这个矩阵一般称为view矩阵，记作<span class="math inline">\(M_v\)</span></p>
<h2 id="投影变换">投影变换</h2>
<p>在倒数第二步，即Projection Matrix变换，将所有想要的点变换到标准的<span class="math inline">\([-1, 1]^3\)</span>立方体内，而在这之外的点被裁剪掉，不再渲染和计算。</p>
<p>投影变换分为正交投影和透视投影两个，以blender为例</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 221; 
			flex-basis: 531px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/4.jpg" data-size="1237x559">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/4.jpg"
			width="1237"
			height="559"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/4_hu1cf76131111eaebcc965c12bd589b1dd_133619_480x0_resize_q75_box.jpg 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/4_hu1cf76131111eaebcc965c12bd589b1dd_133619_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			alt="4.jpg">
	</a>
	
	<figcaption>4.jpg</figcaption>
	
</figure></p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 177; 
			flex-basis: 425px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/3.jpg" data-size="1061x598">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/3.jpg"
			width="1061"
			height="598"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/3_hu2adb0c10195dca832dd074ea1a47d5c8_135697_480x0_resize_q75_box.jpg 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/3_hu2adb0c10195dca832dd074ea1a47d5c8_135697_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			alt="3.jpg">
	</a>
	
	<figcaption>3.jpg</figcaption>
	
</figure></p>
<p>显然，上面的图片中，物体之间没有近大远小，而且地板的纹理都是平行的，此为正交投影。而下图中物体近大远小明显，地板纹理相较于延长线的远端，此为透视投影。</p>
<h3 id="正交投影">正交投影</h3>
<p>正交投影就很简单，将我们想要的一个长方体变换到标准立方体。和之前的视口变换有些相似。先将长方体中心移动到原点，再将其伸缩到标准立方体。假设长方体的前后是near和far（z轴），near&gt;far（记住相机指向<span class="math inline">\(-z\)</span>轴）。左右是left和right（x轴），right&gt;left，上下是top和bottom，top&gt;bottom（y轴）。则变换矩阵如下</p>
<p><span class="math display">\[\begin{bmatrix}
 \dfrac{2}{r-l} & 0 & 0 & 0\\
 0 & \dfrac{2}{t-b} & 0 & 0\\
 0 & 0 & \dfrac{2}{n-f} & 0\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 1 & 0 & 0 & -\dfrac{r+l}{2}\\
 0 & 1 & 0 & -\dfrac{t+b}{2}\\
 0 & 0 & 1 & -\dfrac{n+f}{2}\\
 0 & 0 & 0 & 1
\end{bmatrix}=
\begin{bmatrix}
 \dfrac{2}{r-l} & 0 & 0 & -\dfrac{r+l}{r-l}\\
 0 & \dfrac{2}{t-b} & 0 & -\dfrac{t+b}{t-b}\\
 0 & 0 & \dfrac{2}{n-f} & -\dfrac{n+f}{n-f}\\
 0 & 0 & 0 & 1
\end{bmatrix}
\]</span></p>
<p>记作<span class="math inline">\(M_o\)</span></p>
<h3 id="透视投影">透视投影</h3>
<p>透视投影的作用用一张图来表示</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 216; 
			flex-basis: 518px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/5.jpg" data-size="670x310">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/5.jpg"
			width="670"
			height="310"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/5_hu56610a13d74e28ab1bde8d12bee143fe_25569_480x0_resize_q75_box.jpg 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/5_hu56610a13d74e28ab1bde8d12bee143fe_25569_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			alt="5.jpg">
	</a>
	
	<figcaption>5.jpg</figcaption>
	
</figure></p>
<p>左图中的线可以看作是相机镜头（理想状态下为一个点）接收的光线。可以看到，穿过前面的小矩形（near平面）的光线，随着距离的增长覆盖到了更大的一个矩形（far平面）。而我们的任务，就是把这一个“平截头体”“拍扁”为右侧的长方体。</p>
<p>这个长方体有如下性质：</p>
<ol>
<li>near平面上的点坐标在投影前后不变</li>
<li>far平面上的点的<span class="math inline">\(z\)</span>坐标在投影前后不变</li>
<li>far平面的中心在投影后仍然是中心</li>
</ol>
<p>以二维为例，作图如下</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 218; 
			flex-basis: 523px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/6.jpg" data-size="1115x511">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/6.jpg"
			width="1115"
			height="511"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/6_hufc31e8b5a193f1da8b07dee7a63a265f_35791_480x0_resize_q75_box.jpg 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/6_hufc31e8b5a193f1da8b07dee7a63a265f_35791_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			alt="6.jpg">
	</a>
	
	<figcaption>6.jpg</figcaption>
	
</figure></p>
<p>如图，假设我们要对点<span class="math inline">\((y_1, z_1)\)</span>进行投影，最终其<span class="math inline">\(y\)</span>轴坐标会变为<span class="math inline">\(y_2\)</span>，由相似三角形知识可知</p>
<p><span class="math display">\[y_2 = n\dfrac{y_1}{z_1}
\]</span></p>
<p>同理可得，三维中，除了<span class="math inline">\(y\)</span>的变换，也有</p>
<p><span class="math display">\[x_2 = n\dfrac{x_1}{z_1}
\]</span></p>
<p>注意，我们的性质中没有提到截头体内部<span class="math inline">\(z\)</span>的映射性质，目前还无法直接得到。</p>
<p>根据齐次坐标的性质，我们可以将我们的新点定义为（老点为<span class="math inline">\([x,y,z,1]^T\)</span>）</p>
<p><span class="math display">\[[nx, ny, ??, z]^T = [nx/z,ny/z,??,1]^T
\]</span></p>
<p>将投影变换矩阵写出来如下</p>
<p><span class="math display">\[\begin{bmatrix}
 n & 0 & 0 & 0\\
 0 & n & 0 & 0\\
 ? & ? & ? & ?\\
 0 & 0 & 1 & 0
\end{bmatrix}
\begin{bmatrix}
x\\
y\\
z\\
1
\end{bmatrix}=
\begin{bmatrix}
nx\\
ny\\
?\\
z
\end{bmatrix}
\]</span></p>
<p>因为近平面上的点<span class="math inline">\([x,y,n,1]^T\)</span>在投影前后坐标不变，又因为齐次坐标的性质<span class="math inline">\([x,y,n,1]^T=[nx,ny,n^2,n]^T\)</span>，所以有</p>
<p><span class="math display">\[\begin{bmatrix}
 n & 0 & 0 & 0\\
 0 & n & 0 & 0\\
 A & B & C & D\\
 0 & 0 & 1 & 0
\end{bmatrix}
\begin{bmatrix}
x\\
y\\
n\\
1
\end{bmatrix}=
\begin{bmatrix}
nx\\
ny\\
Ax+By+Cn+D\\
n
\end{bmatrix}=
\begin{bmatrix}
nx\\
ny\\
n^2\\
n
\end{bmatrix}
\]</span></p>
<p>所以有<span class="math inline">\(Ax+By+Cn+D=n^2\)</span>，即<span class="math inline">\(A=0, B=0, Cn+D=n^2\)</span></p>
<p>又因为远平面中心点的坐标变换前后不变，所以有</p>
<p><span class="math display">\[\begin{bmatrix}
 n & 0 & 0 & 0\\
 0 & n & 0 & 0\\
 0 & 0 & C & D\\
 0 & 0 & 1 & 0
\end{bmatrix}
\begin{bmatrix}
0\\
0\\
f\\
1
\end{bmatrix}=
\begin{bmatrix}
0\\
0\\
Cf+D\\
f
\end{bmatrix}=
\begin{bmatrix}
0\\
0\\
f^2\\
f
\end{bmatrix}
\]</span></p>
<p>所以有<span class="math inline">\(Cf+D=f^2\)</span>。</p>
<p>解得</p>
<p><span class="math display">\[C=n+f, D=-nf
\]</span></p>
<p>综上所述，透视投影<span class="math inline">\(M_p\)</span>矩阵为</p>
<p><span class="math display">\[\begin{bmatrix}
 n & 0 & 0 & 0\\
 0 & n & 0 & 0\\
 0 & 0 & n+f & -nf\\
 0 & 0 & 1 & 0
\end{bmatrix}
\]</span></p>
<p>注意，我们用点<span class="math inline">\([x,y,z,1]^T\)</span>去算之后，得到的是<span class="math inline">\([nx,ny,(n+f)z-nf,z]^T\)</span>，这并不是我们想要的数值上的结果，我们还要进行一次除以<span class="math inline">\(z\)</span>（也被称作透视除法），得到<span class="math inline">\([nx/z,ny/z,n+f-nf/z,1]^T\)</span>，才是我们想要的数值结果。</p>
<h3 id="综合">综合</h3>
<p>我们可以用透视投影将截头体变成长方体，而用正交投影则可以将长方体变为标准立方体。显而易见的，要完成整个过程，我们只需要先透视再正交即可：</p>
<p><span class="math display">\[M_oM_p
\]</span></p>
<p>有些教材里会直接将其乘在一起作为<span class="math inline">\(M_p\)</span></p>
<p><span class="math display">\[\begin{bmatrix}
 \dfrac{2n}{r-l} & 0 &  \dfrac{l+r}{l-r} & 0\\
 0 & \dfrac{2n}{t-b} & \dfrac{b+t}{b-t} & 0\\
 0 & 0 &  \dfrac{f+n}{n-f} &  \dfrac{2fn}{f-n}\\
 0 & 0 & 1 & 0
\end{bmatrix}
\]</span></p>
<p>有些地方会比较喜欢使用无穷远的far平面，此时矩阵变为</p>
<p><span class="math display">\[\begin{bmatrix}
 \dfrac{2n}{r-l} & 0 &  \dfrac{l+r}{l-r} & 0\\
 0 & \dfrac{2n}{t-b} & \dfrac{b+t}{b-t} & 0\\
 0 & 0 &  -1 &  2\\
 0 & 0 & 1 & 0
\end{bmatrix}
\]</span></p>
<h3 id="fov与宽高比">FOV与宽高比</h3>
<p>我们确实是可以直接控制<span class="math inline">\(r,l,t,b\)</span>四个值来控制near平面的大小，但是游戏中我们一般是通过控制fov和宽高比来控制视角范围的。现在我们来介绍一下二者如何转化。</p>
<p>首先，我们需要将near平面的中心对准相机的镜头方向，这意味着</p>
<p><span class="math display">\[l=-r
\]</span></p>
<p><span class="math display">\[b=-t
\]</span></p>
<p>同时，这也就意味着其和宽高比的关系为</p>
<p><span class="math display">\[\dfrac{w}{h} = \dfrac{r}{t}
\]</span></p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 189; 
			flex-basis: 455px"
	>
	<a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/7.jpg" data-size="625x329">
		<img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/7.jpg"
			width="625"
			height="329"
			srcset="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/7_huaa4c89d9ea7d3dc0e33e455842cb7f32_17179_480x0_resize_q75_box.jpg 480w, /p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9D%90%E6%A0%87%E5%8F%98%E6%8D%A2%E4%B8%8E%E8%A7%86%E8%A7%92/7_huaa4c89d9ea7d3dc0e33e455842cb7f32_17179_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			alt="7.jpg">
	</a>
	
	<figcaption>7.jpg</figcaption>
	
</figure></p>
<p>如上图，当<span class="math inline">\(n, w, h\)</span>确定之后，我们就可以通过控制<span class="math inline">\(\theta\)</span>来控制<span class="math inline">\(r\)</span>和<span class="math inline">\(t\)</span>。这里的<span class="math inline">\(\theta\)</span>就是FOV。我们这里讨论的是纵向FOV，也有些地方会用横向的。显然，这几个量的关系为</p>
<p><span class="math display">\[\tan\dfrac{\theta}{2} = \dfrac{t}{|n|}
\]</span></p>
<p>只要我们知道<span class="math inline">\(n\)</span>和<span class="math inline">\(\theta\)</span>，那么<span class="math inline">\(t\)</span>就可以推知，从而<span class="math inline">\(r\)</span>也可以根据宽高比推知。</p>
<h2 id="视角变换流水线">视角变换流水线</h2>
<p>从最开始的图可以看出来，我们需要依次经历模型变换、相机变换、投影变换、视口变换，才能得到最终的屏幕坐标，写成如下形式，对于世界坐标的点<span class="math inline">\(p\)</span>，其屏幕坐标<span class="math inline">\(p'\)</span>有</p>
<p><span class="math display">\[p' = M_{vp}M_oM_pM_vM_mp
\]</span></p>
<h1 id="代码">代码</h1>
<p>TODO</p>
<h1 id="附录">附录</h1>
<p>为什么要用四维坐标？其实就是因为平移他不是线性变换，三维的矩阵无法处理三维的平移。但是我们可以通过多加一维的方式来引入平移运算。</p>
<p>具体而言，我们定义三维点<span class="math inline">\((x,y,z)^T\)</span>扩充为四维点<span class="math inline">\((x,y,z,1)^T\)</span>，定义三维向量<span class="math inline">\((x,y,z)^T\)</span>扩充为四维向量<span class="math inline">\((x,y,z,0)^T\)</span>。特别的，对于任意一个四维坐标<span class="math inline">\((x,y,z,w)^T\)</span>，如果<span class="math inline">\(w=0\)</span>，则其代表<span class="math inline">\((x,y,z,0)^T\)</span>这个向量，如果<span class="math inline">\(w\neq 0\)</span>，则其代表<span class="math inline">\((x/w,y/w,z/w,1)^T\)</span>这个点。</p>
<p>这样做的好处是，如果两个点相减，得到的第四维为<span class="math inline">\(0\)</span>，也就得到了一个向量。同理可得两个向量相减还是向量，点减去向量相当于对点进行平移，向量减去点没有意义（除非你理解为点减去向量的相反数）。</p>
<p>还有一个好处，对于任意的平移变换</p>
<p><span class="math display">\[\begin{bmatrix}
 1 & 0 & 0 & t_x\\
 0 & 1 & 0 & t_y\\
 0 & 0 & 1 & t_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\]</span></p>
<p>其作用在点上时，点正确的进行了平移</p>
<p><span class="math display">\[\begin{bmatrix}
 1 & 0 & 0 & t_x\\
 0 & 1 & 0 & t_y\\
 0 & 0 & 1 & t_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z\\
 1
\end{bmatrix}=
\begin{bmatrix}
 x+t_x\\
 y+t_y\\
 z+t_z\\
 1
\end{bmatrix}
\]</span></p>
<p>而其作用在向量上时，并不会平移向量。即</p>
<p><span class="math display">\[\begin{bmatrix}
 1 & 0 & 0 & t_x\\
 0 & 1 & 0 & t_y\\
 0 & 0 & 1 & t_z\\
 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
 x\\
 y\\
 z\\
 0
\end{bmatrix}=
\begin{bmatrix}
 x\\
 y\\
 z\\
 0
\end{bmatrix}
\]</span></p>
<p>这就是数学意义上的向量，永远从原点开始。而与物理中有时讨论的矢量不同，物理中矢量有时可以让起始点在任意地方。</p>
<p>另外，你可能需要经常检查你的点的第四维坐标是否为1，如果不为1，可能会产生各种奇怪的问题。在某些变换矩阵作用后，第四维可能就不为1了，并且你可能不容易发现这个问题。</p>
<h1 id="使用例">使用例</h1>
<p>TODO</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a>
        
            <a href="/tags/%E6%B8%B2%E6%9F%93/">渲染</a>
        
            <a href="/tags/%E5%B9%B2%E8%B4%A7/">干货</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">相关文章</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%85%89%E7%85%A7%E5%88%9D%E6%AD%A5/">
        
        
            <div class="article-image">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%85%89%E7%85%A7%E5%88%9D%E6%AD%A5/cover.a31dfa1d472e7236ca0da074207d7576_hu04f6e4c5c5d9e8c832c6dfeafddfe37e_257114_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-ox36HUcucjbKDaB0IH11dg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">从零开始的软渲染器 光照初步</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E6%A8%A1%E5%9E%8B%E5%BA%93/">
        
        
            <div class="article-image">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E6%A8%A1%E5%9E%8B%E5%BA%93/cover.30e111997b0a8b14a681475f99347374_hu1d5ada73bf6b5a759e3568aecd125470_50161_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-MOERmXsKixSmgUdfmTRzdA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">从零开始的软渲染器 模型库</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E7%BA%BF%E6%AE%B5%E5%92%8C%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E5%85%89%E6%A0%85%E5%8C%96/">
        
        
            <div class="article-image">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E7%BA%BF%E6%AE%B5%E5%92%8C%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E5%85%89%E6%A0%85%E5%8C%96/cover.3eba88ce14bf80744d7e83238ed0ec4e_hu72dadf0d98aceb343e3fe7cb76faf398_301126_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-PrqIzhS/gHRNfoMjjtDsTg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">从零开始的软渲染器 线段和三角形的光栅化</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%BA%93/">
        
        
            <div class="article-image">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%BA%93/cover.941490c741ffb85644dfdbec13c85e5f_hu2fa2362891bfb402ec26ffe12b2b88a0_64078_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-lBSQx0H/uFZE39vsE8heXw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">从零开始的软渲染器 图片处理库</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E6%95%B0%E5%AD%A6%E5%B7%A5%E5%85%B7%E5%BA%93/">
        
        
            <div class="article-image">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84%E8%BD%AF%E6%B8%B2%E6%9F%93%E5%99%A8-%E6%95%B0%E5%AD%A6%E5%B7%A5%E5%85%B7%E5%BA%93/cover.05688f45246317d00a00a986d6147cbd_huc0107afa81d973e7d87fe5de99d27181_24753_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy" 
                        data-key="" 
                        data-hash="md5-BWiPRSRjF9AKAKmG1hR8vQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">从零开始的软渲染器 数学工具库</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo="kegalas/blogComments"
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 KegalaS的个人博客
    </section>
    
    <section class="powerby">
         <br />
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">目录</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#坐标变换">坐标变换</a>
      <ol>
        <li><a href="#缩放">缩放</a></li>
        <li><a href="#平移">平移</a></li>
        <li><a href="#旋转">旋转</a></li>
        <li><a href="#复合变换">复合变换</a></li>
      </ol>
    </li>
    <li><a href="#视角变换">视角变换</a>
      <ol>
        <li><a href="#模型变换">模型变换</a></li>
        <li><a href="#视口变换">视口变换</a></li>
        <li><a href="#相机变换">相机变换</a></li>
        <li><a href="#投影变换">投影变换</a>
          <ol>
            <li><a href="#正交投影">正交投影</a></li>
            <li><a href="#透视投影">透视投影</a></li>
            <li><a href="#综合">综合</a></li>
            <li><a href="#fov与宽高比">FOV与宽高比</a></li>
          </ol>
        </li>
        <li><a href="#视角变换流水线">视角变换流水线</a></li>
      </ol>
    </li>
    <li><a href="#代码">代码</a></li>
    <li><a href="#附录">附录</a></li>
    <li><a href="#使用例">使用例</a></li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
